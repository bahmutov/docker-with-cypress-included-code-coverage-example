name: test
on: push
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: check out code ğŸ›
        uses: actions/checkout@v2
      - name: install NPM dependencies ğŸ“¦
        uses: bahmutov/npm-install@v1

      - name: show current user ğŸ§‘â€ğŸ’»
        run: whoami && id

      - name: run tests ğŸ§ª
        run: |
          docker run -v $PWD:/e2e -w /e2e \
          -e DEBUG=code-coverage \
          cypress/included:4.2.0
      - name: show owner for created files ğŸ‘¤
        run: ls -la . .nyc_output coverage
      - name: show coverage JSON ğŸ–¨
        run: cat ./.nyc_output/out.json
      - name: change owner of .nyc_output ğŸ“
        run: chown -R runner .nyc_output
      - name: check coverage for all files ğŸ“ˆ
        run: npx nyc report --reporter=text --check-coverage --lines 100
      - name: check coverage for single file ğŸ“‰
        run: npx nyc report --reporter=text --check-coverage --lines 100 --include main.js
